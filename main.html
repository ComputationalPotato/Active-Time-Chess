<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-time Chessboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.min.css">
    <link rel="stylesheet" href="styles.css"> <!-- Link to external CSS file -->
    <style>
        .board-container {
            position: relative;
            width: 400px;
            margin: 20px auto;
        }
        .cooldown-overlay {
            position: absolute;
            pointer-events: none;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }
        .button-container {
            text-align: center;
            margin: 20px;
        }
        .cooldown-circle {
            fill: rgba(255, 0, 0, 0.3);
        }
    </style>
</head>

<body>
    <div class="board-container">
        <div id="myBoard"></div>
        <svg class="cooldown-overlay" id="cooldownOverlay"></svg>
    </div>
    <div class="button-container">
        <button id="startBtn">Start Position</button>
        <button id="clearBtn">Clear Board</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chessboard-js/1.0.0/chessboard-1.0.0.js"></script>

    <script type="module">
        import { updateCooldownCircle, updateOverlaySize, isLegalMove, isPathBlocked } from './gamelogic.js';

        $(document).ready(function () {
            let board = null;
            const COOLDOWN_TIME = 3000; // 3 seconds            <----------------------------cooldown set
            const pieceCooldowns = new Map(); // Track piece cooldowns
            let squareSize = 0;

            var config = {
                draggable: true,
                position: 'start',
                onDrop: function(source, target, piece, newPos, oldPos, orientation) {
                    console.log('Attempting move from ' + source + ' to ' + target);
                    
                    if (!isLegalMove(source, target, piece, newPos, oldPos)) {
                        console.log('Illegal move attempted');
                        return 'snapback';
                    }
                    
                    // Set cooldown for the piece
                    pieceCooldowns.set(target, Date.now() + COOLDOWN_TIME);
                    updateCooldownCircle(piece, target);
                    
                    console.log('Move successful');
                    return true;
                },
                onDragStart: function(source, piece, position, orientation) {
                    // Check if piece is on cooldown
                    if (pieceCooldowns.has(source) && Date.now() < pieceCooldowns.get(source)) {
                        return false;
                    }
                    return true;
                },
                onChange: function(oldPos, newPos) {
                    console.log('Board position changed');
                }
            };

            // Initialize board
            board = Chessboard('myBoard', config);
            updateOverlaySize();
            console.log('Board initialized');

            $('#startBtn').on('click', function() {
                board.start();
                pieceCooldowns.clear();
                $('.cooldown-circle').remove();
                console.log('Board reset to start position');
            });

            $('#clearBtn').on('click', function() {
                board.clear();
                pieceCooldowns.clear();
                $('.cooldown-circle').remove();
                console.log('Board cleared');
            });

            $(window).resize(function() {
                board.resize();
                updateOverlaySize();
            });
        });
    </script>
</body>

</html>